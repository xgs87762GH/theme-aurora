<!-- 文章列表组件 -->
<!-- showPagination: 是否显示分页（只有通过路由系统返回的 posts 对象才有完整的分页信息） -->
<!-- paginationContext: 分页的上下文路径（可选，默认为 '/'） -->
<th:block th:fragment="post-list(posts, list_layout, card_gap, card_style, card_animation, image_position, headerWidget, isFirstPage, showPagination, paginationContext)">
  <th:block th:with="skipCount=${isFirstPage and headerWidget == 'latest_post' ? 1 : (isFirstPage and headerWidget == 'latest_post_grid' ? 5 : 0)},postItems=${skipCount gt 0 and not #lists.isEmpty(posts.items) and posts.items.size() gt skipCount ? posts.items.subList(skipCount, posts.items.size()) : posts.items}">
    <!-- 文章列表 -->
    <div
      id="post-list"
      th:if="${posts.total gt 0}"
      class="aurora-post-list"
      th:classappend="|${list_layout == 'grid_2' ? 'grid-2' : ''} ${list_layout == 'grid_3' ? 'grid-3' : ''} ${list_layout == 'grid_4' ? 'grid-4' : ''} ${list_layout == 'single' ? 'single' : ''} ${list_layout == 'list' ? 'list' : ''} ${list_layout == 'masonry' ? 'masonry' : ''} ${card_gap == 'tight' ? 'gap-tight' : ''} ${card_gap == 'medium' ? 'gap-medium' : ''} ${card_gap == 'loose' ? 'gap-loose' : ''} ${card_gap == 'extra_loose' ? 'gap-extra-loose' : ''}|"
    >
      <th:block th:each="post : ${postItems}">
        <th:block
          th:with="cardDirection=${list_layout == 'single' ? 'column' : (list_layout == 'list' ? 'list' : (image_position == 'left' ? 'row' : (image_position == 'right' ? 'row-reverse' : 'row')))}"
          th:replace="~{modules/post-card :: post-card(${post},${image_position != 'none'},${card_animation != 'none'},${card_style == 'bordered'},${cardDirection},${card_style ?: 'default'},${card_animation ?: 'hover_lift'},${image_position ?: 'left'})}"
        />
      </th:block>
    </div>

    <!-- 空状态 -->
    <div th:if="${posts.total == 0}" class="flex items-center justify-center py-16">
      <div class="text-center">
        <span class="i-[tabler--file-off] text-6xl text-gray-300 dark:text-slate-600"></span>
        <p class="mt-4 text-sm font-light text-gray-500 dark:text-slate-400" th:text="#{common.noPosts}"></p>
      </div>
    </div>

    <!-- 分页 -->
    <!-- 注意：postFinder.listByCategory() 返回的 ListResult 对象没有 prevUrl、nextUrl 等分页属性 -->
    <!-- 只有通过路由系统返回的 posts 对象才有完整的分页信息 -->
    <!-- showPagination 标志用于指示是否应该显示分页 -->
    <!-- 关键问题：即使 th:if 为 false，Thymeleaf 仍会解析 th:replace 中的所有表达式 -->
    <!-- 这导致即使 showPagination == false，访问 posts.prevUrl 时仍会抛出异常 -->
    <!-- 解决方案：使用 th:if 完全跳过分页部分，并且确保 showPagination 明确为 true 时才访问分页属性 -->
    <!-- 注意：showPagination 默认为 null，需要明确检查是否为 true（不能使用 != false，因为 null != false 为 true） -->
    <th:block th:if="${showPagination == true and posts.total gt 0}">
      <!-- 当 showPagination == true 时，posts 对象应该有分页信息（来自路由系统） -->
      <!-- 但仍然需要检查分页属性是否存在，以防万一 -->
      <th:block
        th:if="${posts.prevUrl != null and posts.nextUrl != null and posts.totalPages != null and posts.page != null}"
        th:with="paginationCtx=${paginationContext != null ? paginationContext : '/'}"
        class="mt-8"
        th:replace="~{modules/pagination :: pagination(context = ${paginationCtx}, prevUrl = ${posts.prevUrl}, nextUrl = ${posts.nextUrl}, totalPages = ${posts.totalPages}, page = ${posts.page}, hasPrevious = ${posts.hasPrevious()}, hasNext = ${posts.hasNext()})}"
      />
    </th:block>
  </th:block>
</th:block>

