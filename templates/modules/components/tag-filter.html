<div class="flex flex-col gap-4" th:with="tags = ${tagFinder.listAll()}" x-data="{ expanded: false }">
  <div class="flex items-center justify-between">
    <h2 class="inline-flex items-center gap-2 text-base font-medium text-gray-900 dark:text-slate-50">
      <span class="i-tabler-tags text-lg"></span>
      <th:block th:text="#{fragment.tagFilter.allTags}"></th:block>
    </h2>
    <button
      th:if="${not #lists.isEmpty(tags) and tags.size() gt 15}"
      type="button"
      @click="expanded = !expanded"
      class="inline-flex items-center gap-1 text-xs font-medium text-blue-600 transition-colors hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300"
    >
      <span x-show="!expanded" x-cloak>展开全部</span>
      <span x-show="expanded" x-cloak>收起</span>
      <i x-show="!expanded" class="i-tabler-chevron-down size-3 transition-transform"></i>
      <i x-show="expanded" class="i-tabler-chevron-up size-3 transition-transform"></i>
    </button>
  </div>
  <div class="relative">
    <div
      class="tag-list flex flex-wrap gap-2 transition-all duration-300"
      :class="expanded ? 'max-h-none' : 'max-h-[5rem] overflow-hidden'"
      th:classappend="${#lists.isEmpty(tags) or tags.size() le 15 ? 'max-h-none' : ''}"
    >
      <a
        th:each="tagItem,tagStat: ${tags}"
        th:href="@{|/tags?tag=${tagItem.metadata.name}|}"
        th:title="${tagItem.spec.displayName}"
        class="inline-flex items-center gap-x-1.5 rounded-full border border-gray-200 bg-white px-2.5 py-1 text-xs font-medium text-gray-800 shadow-sm transition-all hover:border-blue-400 hover:bg-blue-50 hover:text-blue-600 dark:border-slate-700 dark:bg-slate-800 dark:text-slate-200 dark:hover:border-blue-400 dark:hover:bg-blue-900/20 dark:hover:text-blue-400"
        th:classappend="(${tag} and ${tag.metadata.name == tagItem.metadata.name}) or (not ${tag} and ${tagStat.index == 0}) ? '!border-blue-400 !bg-blue-50 !text-blue-600 dark:!border-blue-400 dark:!bg-blue-900/20 dark:!text-blue-400' : ''"
      >
        <th:block th:text="|#${tagItem.spec.displayName}|" />
        <sup class="ml-0.5 text-[10px]" th:text="${tagItem.postCount ?: 0}"></sup>
      </a>
    </div>
    <!-- 渐变遮罩（折叠时显示） -->
    <div
      th:if="${not #lists.isEmpty(tags) and tags.size() gt 15}"
      x-show="!expanded"
      x-cloak
      class="pointer-events-none absolute bottom-0 left-0 right-0 h-8 bg-gradient-to-t from-white via-white/80 to-transparent dark:from-slate-800 dark:via-slate-800/80"
    ></div>
  </div>
</div>

