<!DOCTYPE html>
<!-- 检测是否为片段请求（仅返回文章列表） -->
<th:block
  th:if="${param.fragment != null and not #lists.isEmpty(param.fragment) and param.fragment[0] == 'post-list'}"
  xmlns:th="https://www.thymeleaf.org"
>
  <!-- 仅返回文章列表容器内容，不包含任何 HTML 结构 -->
  <div id="post-list-container">
    <th:block
      th:with="categoryParam=${param.category != null and not #lists.isEmpty(param.category) ? param.category[0] : null},selectedCategory=${categoryParam != null ? categoryFinder.getByName(categoryParam) : null},currentPage=${param.page != null and not #lists.isEmpty(param.page) ? T(java.lang.Integer).valueOf(param.page[0]) : 1},bannerHeight=${theme.config.header.top_banner_height ?: 'half'},headerWidget=${bannerHeight == 'third' ? (theme.config.header.header_widget_3 ?: 'none') : (theme.config.header.header_widget ?: 'none')},isFirstPage=${currentPage == 1},basePageSize=${theme.config.post_list.posts_per_page ?: 12},pageSize=${isFirstPage and headerWidget == 'latest_post_grid' ? (basePageSize + 5) : basePageSize},filteredPosts=${selectedCategory != null ? postFinder.list({page: currentPage, size: pageSize, categoryName: selectedCategory.metadata.name}) : postFinder.list({page: currentPage, size: pageSize})},base_layout=${theme.config.post_list.post_list_layout ?: 'grid_2'},enable_masonry=${theme.config.post_list.enable_masonry ?: false},list_layout=${(base_layout == 'grid_2' or base_layout == 'grid_3' or base_layout == 'grid_4') and enable_masonry == true ? 'masonry' : base_layout},card_gap=${theme.config.post_list.card_gap ?: 'medium'},card_style=${theme.config.post_list.card_style ?: 'default'},card_animation=${theme.config.post_list.card_animation ?: 'hover_lift'},image_position=${theme.config.post_list.post_image_position ?: 'left'},totalPages=${filteredPosts.totalPages},hasPrevious=${filteredPosts.hasPrevious()},hasNext=${filteredPosts.hasNext()},prevUrl=${hasPrevious ? (selectedCategory != null ? ('/?category=' + selectedCategory.metadata.name + '&page=' + (currentPage - 1)) : ('/?page=' + (currentPage - 1))) : null},nextUrl=${hasNext ? (selectedCategory != null ? ('/?category=' + selectedCategory.metadata.name + '&page=' + (currentPage + 1)) : ('/?page=' + (currentPage + 1))) : null}"
    >
      <th:block th:replace="~{modules/posts/post-list :: post-list(posts = ${filteredPosts}, list_layout = ${list_layout}, card_gap = ${card_gap}, card_style = ${card_style}, card_animation = ${card_animation}, image_position = ${image_position}, headerWidget = ${headerWidget}, isFirstPage = ${isFirstPage}, showPagination = false, paginationContext = null)}" />
      
      <!-- 手动构建分页 -->
      <th:block th:if="${filteredPosts.total gt 0 and totalPages gt 1}">
        <div class="mt-8 flex items-center justify-between">
          <a
            th:href="@{${prevUrl}}"
            th:if="${hasPrevious}"
            class="whitespace-no-wrap group inline-flex items-center justify-center gap-1 rounded-md border border-gray-200 bg-white px-4 py-1 text-sm font-medium leading-6 text-gray-600 shadow-sm hover:bg-gray-50 focus:shadow-none focus:outline-none dark:border-slate-600 dark:bg-slate-700 dark:text-slate-100 dark:hover:bg-slate-600 dark:hover:text-white"
          >
            <span class="i-tabler-arrow-left text-lg transition-all group-hover:-translate-x-1"></span>
            <span th:text="#{common.previousPage}"></span>
          </a>
          <span th:unless="${hasPrevious}" class="whitespace-no-wrap inline-flex items-center justify-center gap-1 rounded-md border border-gray-200 bg-white px-4 py-1 text-sm font-medium leading-6 text-gray-400 pointer-events-none opacity-60 dark:border-slate-600 dark:bg-slate-700 dark:text-slate-500">
            <span class="i-tabler-arrow-left text-lg"></span>
            <span th:text="#{common.previousPage}"></span>
          </span>
          
          <select id="pagination-index" class="bg-transparent text-sm text-gray-900 outline-none dark:text-slate-50">
            <option
              th:each="i : ${#numbers.sequence(1,totalPages)}"
              th:selected="${i == currentPage}"
              th:value="${i}"
              th:text="|${i} / ${totalPages}|"
              class="bg-white text-gray-900 dark:bg-slate-700 dark:text-slate-50"
            ></option>
          </select>
          
          <a
            th:href="@{${nextUrl}}"
            th:if="${hasNext}"
            class="whitespace-no-wrap group inline-flex items-center justify-center gap-1 rounded-md border border-gray-200 bg-white px-4 py-1 text-sm font-medium leading-6 text-gray-600 shadow-sm hover:bg-gray-50 focus:shadow-none focus:outline-none dark:border-slate-600 dark:bg-slate-700 dark:text-slate-100 dark:hover:bg-slate-600 dark:hover:text-white"
          >
            <span th:text="#{common.nextPage}"></span>
            <span class="i-tabler-arrow-right text-lg transition-all group-hover:translate-x-1"></span>
          </a>
          <span th:unless="${hasNext}" class="whitespace-no-wrap inline-flex items-center justify-center gap-1 rounded-md border border-gray-200 bg-white px-4 py-1 text-sm font-medium leading-6 text-gray-400 pointer-events-none opacity-60 dark:border-slate-600 dark:bg-slate-700 dark:text-slate-500">
            <span th:text="#{common.nextPage}"></span>
            <span class="i-tabler-arrow-right text-lg"></span>
          </span>
        </div>
        
        <script th:inline="javascript">
          document.addEventListener("DOMContentLoaded", () => {
            const paginationSelect = document.getElementById("pagination-index");
            if (!paginationSelect) return;
            
            paginationSelect.addEventListener("change", (event) => {
              const selectedPage = event.target.value;
              const currentUrl = new URL(window.location.href);
              const categoryParam = /*[[${categoryParam}]]*/ null;
              if (categoryParam) {
                currentUrl.searchParams.set("category", categoryParam);
              }
              currentUrl.searchParams.set("page", selectedPage);
              window.location.href = currentUrl.toString();
            });
          });
        </script>
      </th:block>
    </th:block>
  </div>
</th:block>

<!-- 完整页面（默认） -->
<html
  xmlns:th="https://www.thymeleaf.org"
  th:if="${param.fragment == null or #lists.isEmpty(param.fragment) or param.fragment[0] != 'post-list'}"
  th:replace="~{modules/layouts/layout :: html(title = ${site.title}, hero = null, content = ~{::content}, head = null, footer = null, sidebar = null, contentClass = null)}"
>
  <th:block th:fragment="content">
    <!-- 顶部大图 -->
    <th:block th:replace="~{modules/layouts/home-layout :: top-banner}" />

    <!-- 三栏布局（包含文章列表）- 当 banner 固定时，内容需要相对定位以叠加在背景上 -->
    <div th:with="bannerHeight=${theme.config.header.top_banner_height ?: 'half'}" th:classappend="${bannerHeight == 'full' ? 'relative z-10' : ''}">
      <th:block
        th:replace="~{modules/layouts/home-layout :: three-column-layout-with-posts(leftContent = null, rightContent = null, showCategoryFilter = ${(theme.config.header.show_category_filter ?: true) == true})}"
      />
    </div>

    <!-- 页脚容器 - 当 banner 全屏时，确保页脚在内容层之上 -->
    <!-- <div th:classappend="${theme.config.header.top_banner_height == 'full' ? 'relative z-10' : ''}">
      <th:block th:replace="~{modules/footer}" />
    </div> -->
  </th:block>
</html>
<style>
  .aurora-body {
    padding-top: 20px !important;
  }
</style>
